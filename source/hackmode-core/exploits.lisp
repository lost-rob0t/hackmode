(in-package :hackmode)

(defclass exploit ()
  ((name :initarg :name :accessor exploit-name :initform (error "Invalid exploit Error: exploit requires a name"))
   (platform :initarg :platform :accessor exploit-platform :initform (error "Invalid exploit Error: exploit requires a platform"))
   (help :initarg :help :accessor exploit-help :initform nil)
   (options :initarg :options :accessor exploit-options :initform nil)
   (func :initarg :func :accessor exploit-func :initform (lambda () (format t "Its an exploit!")))
   (setup :initarg :exploit-setup :accessor exploit-setup :initform (lambda () (format t "Exploit setup function!")))))



(defclass exploit-option ()
  ((name :initarg :name :accessor exploit-option-name :initform (error 'invalid-object-error :slot :name))
   (option-type :initarg :option-type :accessor exploit-option-type :initform (error 'invalid-object-error :slot :option-type))
   (documentation :initarg :documentation :accessor exploit-option-documentation :initform (progn (warn "You Should document your exploit options.") "option for exploit."))))


(defvar *current-exploit*  (make-instance 'exploit :name "Hackmode" :platform "hackmode") "The Current package to be ran. this may be a exploit, a tool, ect.")
(defvar *exploits* (dict) "The current list of loaded exploits in hackmode.")



(defmethod use ((exploit exploit))
  (setq *current-exploit* exdploit))

(defmethod run-exploit ((exploit exploit))
  (funcall (exploit-setup exploit))
  (funcall (exploit-func exploit)))
;; (nhooks:run-hook '*history-hook* (make-history (format nil  "run ~a" (exploit-name exploit))))
